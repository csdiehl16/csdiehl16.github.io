<!DOCTYPE html><html lang="en" class="antialiased break-words"> <head><!-- Google tag (gtag.js) --><script type="text/partytown" async src="https://www.googletagmanager.com/gtag/js?id=G-NMTRKRDQZV"></script><script type="text/partytown">
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-NMTRKRDQZV');
        </script><!-- High Priority Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Mysterious missing weather stations and other lessons from tracking global heat | Caleb Diehl</title><meta name="generator" content="Astro v4.16.18"><!-- Fonts --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400..700&family=Newsreader:ital,opsz,wght@0,6..72,400..700;1,6..72,400..700&display=swap" rel="stylesheet"><!-- Low Priority Global Metadata --><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="RSS"><!-- Page Metadata --><link rel="canonical" href="https://csdiehl.github.io/blog/post-1/"><meta name="description" content="how we built a global heat tracker for the Associated Press."><!-- Open Graph / Facebook --><meta property="og:type" content="article"><meta property="og:url" content="https://csdiehl.github.io/blog/post-1/"><meta property="og:title" content="Mysterious missing weather stations and other lessons from tracking global heat | Caleb Diehl"><meta property="og:description" content="how we built a global heat tracker for the Associated Press."><meta property="og:image" content="https://csdiehl.github.io/heat_tracker.png"><meta property="og:image:alt" content="An application to track extreme heat throughout the world"><!-- X/Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://csdiehl.github.io/blog/post-1/"><meta property="twitter:title" content="Mysterious missing weather stations and other lessons from tracking global heat | Caleb Diehl"><meta property="twitter:description" content="how we built a global heat tracker for the Associated Press."><meta property="twitter:image" content="https://csdiehl.github.io/heat_tracker.png"><meta name="twitter:image:alt" content="An application to track extreme heat throughout the world"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/astro/carbon-calculator.Skov_dzA.css">
<style>h2{margin:2.5rem 8px}p,li{margin:1.5rem 8px;color:#181818;font-size:1rem;line-height:1.25rem}a{color:#37aecc;font-weight:700}code{font-family:Consolas,monospace;color:#d3d3d3}pre{padding:16px;border-radius:8px;margin:0 8px}
</style><script type="module" src="/astro/hoisted.YW3grJYV.js"></script>
<script>!(function(w,p,f,c){if(!window.crossOriginIsolated && !navigator.serviceWorker) return;c=w[p]=Object.assign(w[p]||{},{"lib":"/~partytown/","debug":false});c[f]=(c[f]||[]).concat(["dataLayer.push"])})(window,'partytown','forward');/* Partytown 0.11.0 - MIT QwikDev */
const t={preserveBehavior:!1},e=e=>{if("string"==typeof e)return[e,t];const[n,r=t]=e;return[n,{...t,...r}]},n=Object.freeze((t=>{const e=new Set;let n=[];do{Object.getOwnPropertyNames(n).forEach((t=>{"function"==typeof n[t]&&e.add(t)}))}while((n=Object.getPrototypeOf(n))!==Object.prototype);return Array.from(e)})());!function(t,r,o,i,a,s,c,l,d,p,u=t,f){function h(){f||(f=1,"/"==(c=(s.lib||"/~partytown/")+(s.debug?"debug/":""))[0]&&(d=r.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(l=setTimeout(v,(null==s?void 0:s.fallbackTimeout)||1e4),r.addEventListener("pt0",w),a?y(1):o.serviceWorker?o.serviceWorker.register(c+(s.swPath||"partytown-sw.js"),{scope:c}).then((function(t){t.active?y():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&y()}))}),console.error):v())))}function y(e){p=r.createElement(e?"script":"iframe"),t._pttab=Date.now(),e||(p.style.display="block",p.style.width="0",p.style.height="0",p.style.border="0",p.style.visibility="hidden",p.setAttribute("aria-hidden",!0)),p.src=c+"partytown-"+(e?"atomics.js?v=0.11.0":"sandbox-sw.html?"+t._pttab),r.querySelector(s.sandboxParent||"body").appendChild(p)}function v(n,o){for(w(),i==t&&(s.forward||[]).map((function(n){const[r]=e(n);delete t[r.split(".")[0]]})),n=0;n<d.length;n++)(o=r.createElement("script")).innerHTML=d[n].innerHTML,o.nonce=s.nonce,r.head.appendChild(o);p&&p.parentNode.removeChild(p)}function w(){clearTimeout(l)}s=t.partytown||{},i==t&&(s.forward||[]).map((function(r){const[o,{preserveBehavior:i}]=e(r);u=t,o.split(".").map((function(e,r,o){var a;u=u[o[r]]=r+1<o.length?u[o[r]]||(a=o[r+1],n.includes(a)?[]:{}):(()=>{let e=null;if(i){const{methodOrProperty:n,thisObject:r}=((t,e)=>{let n=t;for(let t=0;t<e.length-1;t+=1)n=n[e[t]];return{thisObject:n,methodOrProperty:e.length>0?n[e[e.length-1]]:void 0}})(t,o);"function"==typeof n&&(e=(...t)=>n.apply(r,...t))}return function(){let n;return e&&(n=e(arguments)),(t._ptf=t._ptf||[]).push(o,arguments),n}})()}))})),"complete"==r.readyState?h():(t.addEventListener("DOMContentLoaded",h),t.addEventListener("load",h))}(window,document,navigator,top,window.crossOriginIsolated);;(e=>{e.addEventListener("astro:before-swap",e=>{let r=document.body.querySelector("iframe[src*='/~partytown/']");if(r)e.newDocument.body.append(r)})})(document);</script></head> <body class="bg-main text-main"> <div class="flex flex-col min-h-screen"> <nav class="py-4 sticky top-0 bg-[#F2F1EB] flex items-start z-10" data-astro-cid-dmqpwcec> <div class="w-full max-w-3xl mx-6 relative" data-astro-cid-dmqpwcec> <button class="menu-toggle w-8 h-8 -ml-1 flex items-center justify-center relative z-30 md:hidden" aria-label="Open Menu" aria-expanded="false" aria-controls="menu-items" data-astro-cid-dmqpwcec> <span class="menu-toggle-icon w-6 h-px relative bg-current" data-astro-cid-dmqpwcec></span> </button> <ul id="menu-items" class="menu flex gap-6" data-astro-cid-dmqpwcec> <li class="py-1" data-astro-cid-dmqpwcec> <a class="text-xl hover:underline hover:underline-offset-2 hover:decoration-1 md:text-2xl md:font-semibold md:text-gray-600" href="/" data-astro-cid-dmqpwcec> Projects </a> </li><li class="py-1" data-astro-cid-dmqpwcec> <a class="text-xl hover:underline hover:underline-offset-2 hover:decoration-1 md:text-2xl md:font-semibold md:text-gray-600" href="/about" data-astro-cid-dmqpwcec> About </a> </li><li class="py-1" data-astro-cid-dmqpwcec> <a class="text-xl hover:underline hover:underline-offset-2 hover:decoration-1 md:text-2xl md:font-semibold md:text-gray-600" href="/blog" data-astro-cid-dmqpwcec> Blog </a> </li> </ul> </div> <div class="absolute right-0 top-4 z-10 md:top-8" data-astro-cid-dmqpwcec>  </div> </nav>   <main class="grow w-full mx-auto max-w-5xl">  <article class="relative z-0 flex flex-1 flex-col"> <div class="mx-auto w-full max-w-screen-lg md:-mb-10 lg:-mb-12 xl:-mb-16"> <img class="object-cover w-full min-h-[240px]" src="/heat_tracker.png"> </div> <header class="p-8 bg-[#F2F1EC] max-w-screen-md mx-auto mb-8"> <h1 class="text-3xl leading-tight font-medium sm:text-5xl sm:leading-tight">Mysterious missing weather stations and other lessons from tracking global heat</h1> <div class="mt-4 text-sm"> <time datetime="2024-03-04T08:00:00.000Z"> March 4, 2024 </time>  </div> </header> <div class="max-w-full md:max-w-screen-md text-md mx-auto"> <p>How can we show how much hotter it is than normal, every day, in every part of the world?</p>
<p>A colleague and I on the data team at The Associated Press built an interactive tracker to answer this question. In the process, we wrestled with more fundamental questions like what is “normal”? What does “nearest” mean? And why is nobody measuring the weather in Africa?</p>
<h2 id="mysterious-missing-weather-stations">Mysterious missing weather stations</h2>
<p>Satellites and weather stations track global temperature. We used both of these sources for our tracker. In this post, I’m going to focus on the latter.</p>
<p>Reading the weather each day, you might take for granted that we know the temperature of any point on Earth at any given time. But finding this information reliably over a 30-year period is complicated.</p>
<p>First, a myriad of public agencies, including NOAA, the military, and others, manage weather stations. Fortunately, one agency, the World Meteorological Organization, maintains a global network of stations that more or less report the same data.</p>
<p>When I first plotted this network on a map, I thought I had inadvertently dropped data. Almost nothing showed up in Africa or South America.</p>
<p>I had stumbled upon a massive equity issue.</p>
<img class="m-auto max-w-screen-md max-md:max-w-full rounded-md px-4" width="100%" src="https://e360.yale.edu/assets/site/_1500x1500_fit_center-center_80/Weather-Radar-Stations.png">
<p>Many nations in the Global South lack functional weather stations. Africa, a continent with 1.2 billion people, <a href="https://e360.yale.edu/features/africa-weather-stations-climate-change">has just 37 WMO weather stations</a> . Meanwhile, the U.S. and E.U. combined have 636 weather radar stations for a population of 1.1 billion. Because of this disparity, US citizens were able to evacuate disasters like Hurricane Ida without major loss of life, while disasters such as Cyclone Idai hit Africa without warning.</p>
<p>Even among existing stations, we couldn’t collect enough data to depend on them. Many have fallen into disrepair. In Africa, only 1 in 5 stations met the WMO reporting standards in 2019. Among the many <a href="https://www.washingtonpost.com/world/2021/09/24/africa-climate-weather-data/">reasons for this</a> are a lack of government support, staffing and technological infrastructure.</p>
<p>We filtered out hundreds of stations worldwide that haven’t recorded a blip of data in at least three years. Even the most reliable stations have a 3-5 day time lag between when the data is transmitted, and when it is processed and made available to the APIs we consume.</p>
<h3 id="the-heat-tracker-in-action">The heat tracker in action!</h3>
<iframe class="m-auto max-w-screen-md max-md:max-w-full rounded-md px-4" src="https://interactives.ap.org/heat-tracker/" scrolling="no" frameborder="0" width="100%" height="900"></iframe>
<h2 id="pairing-the-stations-with-cities">Pairing the stations with cities</h2>
<p>Originally, we envisioned a sort of Billboard top 100 of hottest cities in the world right now. We found a dataset of the world’s 1,000 or so most populous cities. I wrote a Python script that matched each one to its nearest weather station. We filtered out any cities that didn’t have a station within 5 miles. Seemed simple enough.</p>
<p>But not really.</p>
<p>“Nearest” is not as straightforward a concept as it seems, in spatial analysis. To measure distance, we need to calculate it across a flat surface. Because the world is a sphere, and our books and screens are flat, we need projections to map between them. There are hundreds of projection functions ranging from basic rectangles (Mercator) to encapsulating the world in a twenty-sided die and unrolling it (Dymaxion). Any projection will have distortion, depending on what area you choose to focus. Certain projections are optimized for local places.</p>
<p>You can’t use one single projection to measure distances in all parts of the world. The best solution I could find is called Great Circle, or <a href="https://community.esri.com/t5/coordinate-reference-systems-blog/distance-on-a-sphere-the-haversine-formula/ba-p/902128">“Haversine” distance</a>, which is measured in degrees as the distance around a sphere. It looks like the flight path of a plane.</p>
<img class="m-auto max-w-screen-md max-md:max-w-full rounded-md px-4" width="350px" src="https://media.licdn.com/dms/image/C4D12AQE0QbVF-y7cNg/article-cover_image-shrink_600_2000/0/1531928404478?e=2147483647&#x26;v=beta&#x26;t=_J31oxVLse5Ujz54gN10QVrzC44j66tccB-84ZP6uTA">
<p>This led to more problems, however. We had to establish a cutoff in degrees, which seemed nonsensical, or arbitrary at best.</p>
<p>And who decides where the “city center” is? City hall? The Central Business District? <a href="https://www.jstor.org/stable/26696385">One paper</a> identifies no less than 5 valid ways of deciding what is the “center.”</p>
<p>It turns out that nearly all WMO weather stations occupy an airport. Makes sense given how critical weather is to piloting. The distance of the center to the airport varies widely for most cities.</p>
<p>In the end, we decided it didn’t make sense to assign an arbitrary cutoff. Instead we let the stations stand on their own, and improved the map labeling and orientation with user controls like a search bar and geolocator.</p>
<h2 id="what-is-a-normal-temperature">What is a “normal” temperature?</h2>
<p>After we were confident in our stations, we got down to the business of measuring the temperature. Absolute temperatures mattered little. We needed the deviation from average, or “normal” temperatures.</p>
<p>What is “normal?” Scientists have largely agreed it is the average of temperatures over a 30-year period. Technically, it’s not just an average — there is complex math to interpolate missing data points.</p>
<p>You also have to consider different time resolutions. You can average temperatures year by year, or month by month, or day by day. You can take the average of all the high temperatures or all the low temperatures, or work with all values recorded in each day.</p>
<h2 id="so-which-normal-should-we-use">So, which “normal” should we use?</h2>
<p>Ideally, we would use a 30-year period from way in the past, before anthropogenic warming. Unfortunately, this was not possible at a global scale with existing data. The best the WMO provides is 1991-2020 normals. So what you see in the heat tracker, which still shows quite a bit of deviation from normal, is warming after much human-caused climate change.</p>
<p>I spoke with a climate scientist at NOAA to learn how to use their weather station data. Refreshingly, they thought it was as confusing to work with as I did. They reassured us that we could compare the average temperature for a single day to the monthly normal. It wasn’t exact, but was good enough.</p>
<p>We started with this, but then realized — for tracking heat, we cared about the hottest temperatures. We envisioned users checking this to see the impacts of recent heatwaves. So we subtracted the high temperature for the day from the “normal” — the average of high temperatures for that month over the 30-year baseline.</p>
<p>However, we needed one more step. Some days are quite hotter than others. That doesn’t necessarily mean there is an abnormal heat wave going on. Any time series will seasonal peaks and valleys in the overall trend line. To smooth out this daily noise, we compared the average high temperature from the past week with the average high for the month.</p>
<h2 id="updating-the-temperature-every-day">Updating the temperature every day</h2>
<p>For the final setup, Our Python scripts query the National Center for Environmental Information’s <a href="https://www.ncei.noaa.gov/support/access-data-service-api-user-documentation">common access API</a>. Their normals endpoint returns monthly temperature normals given a list of stations.</p>
<p>We have a pre-filtered station list that we made, using another Python script. It contains reliable stations with long-term normals that also exist on a list of stations with reliable daily results from Common Access. We loop through all of our stations and get the latest temperature readings. We compare these to the normals we have stored for these stations.</p>
<p>Every day, we run these scripts via Gitlab actions. In our Gitlab repo, we store a <code>.yml</code> file that sets up the environment and runs the scripts each day. After the script runs, it pushes the output to a publicly readable S3 bucket.</p>
<p>The frontend is a React / Typescript app. We simply fetch the data from S3 and display it on a map. For the visualization, the map is built with <a href="https://maplibre.org/">Maplibre</a>, and the line chart is rendered using SVG and D3.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Like all data viz projects, this one turned out to have many considerations I couldn’t have foreseen. But that’s what makes a project like this so fascinating.</p>
<p>The most important insight was the lack of attention to measuring climate and weather in the Global South. The biggest question I get about the project is “why isn’t x country on the map?” A host of political and historical reasons are behind this question. To ensure a safe and equitable climate future, it’s imperative that we focus more resources and attention on weather stations in underserved areas.</p> </div> <div class="mt-8 flex flex-wrap items-center gap-6 text-sm justify-between sm:mt-12 sm:text-base"> <div class="flex flex-wrap gap-x-5 gap-y-1 text-sm"> <a class="text-main hover:underline" href="/tags/python">
#Python </a><a class="text-main hover:underline" href="/tags/climate-data">
#Climate data </a> </div> <button class="inline-flex items-center justify-center px-6 py-2 font-serif text-sm leading-tight italic  text-main bg-main border border-main rounded-full transition hover:bg-muted copy-url-button" aria-label="Copy link" data-url="https://csdiehl.github.io/blog/post-1/" data-tooltip-default="Copy link" data-tooltip-success="Copied">Share</button> </div> </article> <div class="my-16 sm:my-24"> <h2 class="mb-12 text-xl font-serif italic sm:mb-16 sm:text-2xl">Read Next</h2> <a class="flex justify-between items-start gap-8 group mb-10 sm:mb-12" href="/blog/post-2/"> <div class="grow"> <h3 class="text-xl leading-tight font-medium group-hover:underline group-hover:decoration-dashed group-hover:underline-offset-4 group-hover:decoration-1 sm:text-2xl">Observations on the new Observable 2.0 Framework</h3> <div class="mt-1 text-sm leading-normal"> <time datetime="2024-03-13T07:00:00.000Z"> March 13, 2024 </time>  </div> <div class="mt-3 text-sm leading-normal">My thoughts on Observable&#39;s latest creation.</div> </div> <div class="hidden font-serif italic opacity-0 transition group-hover:opacity-100 sm:inline-flex sm:gap-1 sm:items-center sm:shrink-0">
Read Post <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current w-4 h-4"> <path d="M4.286 12c0-0.533 0.432-0.964 0.964-0.964v0h11.172l-4.14-4.138c-0.175-0.175-0.283-0.416-0.283-0.683 0-0.533 0.432-0.965 0.965-0.965 0.267 0 0.508 0.108 0.683 0.283v0l5.785 5.785c0.175 0.175 0.283 0.416 0.283 0.683s-0.108 0.508-0.283 0.683l-5.785 5.785c-0.175 0.175-0.416 0.283-0.683 0.283-0.533 0-0.965-0.432-0.965-0.965 0-0.267 0.108-0.508 0.283-0.683v0l4.14-4.138h-11.172c-0.533 0-0.964-0.432-0.964-0.964v0z"></path> </svg> </div> </a>  </div> </main> <footer class="w-full max-w-3xl mx-auto pt-12 pb-10 sm:pt-24 sm:pb-14"> <div class="mb-4 flex flex-wrap gap-x-6 gap-y-1"> <a class="font-serif hover:underline hover:underline-offset-2" href="/about"> About </a><a class="font-serif hover:underline hover:underline-offset-2" href="/contact"> Contact </a> </div> <div class="pt-6 flex flex-col gap-4 border-t border-dashed border-main sm:flex-row-reverse sm:justify-between sm:items-center"> <div class="flex flex-wrap gap-x-4 gap-y-1"> <a class="inline-flex items-center justify-center text-sm hover:underline hover:underline-offset-2" href="https://dribbble.com/" target="_blank" rel="noopener noreferer"> Linkedin </a><a class="inline-flex items-center justify-center text-sm hover:underline hover:underline-offset-2" href="https://instagram.com/" target="_blank" rel="noopener noreferer"> Github </a> </div> <p class="text-sm">
&copy; 2025&nbsp;<a class="hover:underline hover:underline-offset-2" href="/">Caleb Diehl</a>. All rights reserved.
</p> </div> </footer> </div> </body></html> 